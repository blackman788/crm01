<!DOCTYPE html>
{# 导入静态资源 #}
{% load static %}
<html>
<head>
    <title>客户关系管理系统</title>
    {% include 'base.html' %}
</head>
<body class="easyui-layout">
{# 上边 #}
<div region="north" style="height: 78px;background-color: #E0ECFF;overflow: hidden;">
    <table style="padding: 5px" width="100%">
        <tr>
            <td width="50%">
                <img alt="logo" src="{% static 'system/images/bglogo.png' %}">
            </td>
            <td valign="bottom" align="right" width="50%">
                <strong style="font-size: 16px">欢迎【{{ request.session.user_name }}】登录</strong>
            </td>
        </tr>
    </table>
</div>
{# 中间 #}
<div region="center">
    <div class="easyui-tabs" fit="true" border="false" id="tabs">
        <div title="首页" data-options="iconCls:'icon-home'">
            <div align="center" style="padding-top: 100px"><font color="red" size="10">欢迎回来</font></div>
        </div>
    </div>
</div>
{# 左边菜单 #}
<div region="west" style="width: 200px" title="导航菜单" split="true">
    <div class="easyui-accordion" data-options="fit:true,border:false">

        <div title="营销管理" data-options="selected:true,iconCls:'icon-yxgl'" style="padding: 10px">
            <a href="javascript:openTab('营销机会管理', '','icon-yxjhgl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-yxjhgl'" style="width: 150px">营销机会管理</a>
            <a href="javascript:openTab('客户开发计划','','icon-khkfjh')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khkfjh'" style="width: 150px">客户开发计划</a>
        </div>

        <div title="客户管理" data-options="iconCls:'icon-khgl'" style="padding:10px;">
            <a href="javascript:openTab('客户信息管理','','icon-khxxgl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khxxgl'" style="width: 150px;">客户信息管理</a>
            <a href="javascript:openTab('客户流失管理','','icon-khlsgl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khlsgl'" style="width: 150px;">客户流失管理</a>
        </div>


        <div title="服务管理" data-options="iconCls:'icon-fwgl'" style="padding:10px">
            <a href="javascript:openTab('服务创建','','icon-fwcj')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-fwcj'" style="width: 150px;">服务创建</a>
            <a href="javascript:openTab('服务分配','','icon-fwfp')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-fwfp'" style="width: 150px;">服务分配</a>
            <a href="javascript:openTab('服务处理','','icon-fwcl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-fwcl'" style="width: 150px;">服务处理</a>
            <a href="javascript:openTab('服务反馈','','icon-fwfk')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-fwfk'" style="width: 150px;">服务反馈</a>
            <a href="javascript:openTab('服务归档','','icon-fwgd')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-fwgd'" style="width: 150px;">服务归档</a>
        </div>


        <div title="统计报表" data-options="iconCls:'icon-tjbb'" style="padding:10px">
            <a href="javascript:openTab('客户贡献分析','','icon-khgxfx')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khgxfx'" style="width: 150px;">客户贡献分析</a>
            <a href="javascript:openTab('客户构成分析','','icon-khgcfx')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khgcfx'" style="width: 150px;">客户构成分析</a>
            <a href="javascript:openTab('客户服务分析','','icon-khfwfx')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khfwfx'" style="width: 150px;">客户服务分析</a>
            <a href="javascript:openTab('客户流失分析','','icon-khlsfx')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-khlsfx'" style="width: 150px;">客户流失分析</a>
        </div>


        <div title="基础数据管理" data-options="iconCls:'icon-jcsjgl'" style="padding:10px">
            <a href="javascript:openTab('数据字典管理','','icon-sjzdgl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-sjzdgl'" style="width: 150px;">数据字典管理</a>
            <a href="javascript:openTab('产品信息查询','','icon-cpxxgl')" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-cpxxgl'" style="width: 150px;">产品信息查询</a>
        </div>


        <div title="系统管理" data-options="iconCls:'icon-item'" style="padding:10px">
            <a href="#" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-user'" style="width: 150px;">用户管理</a>
            <a href="#" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-user'" style="width: 150px;">角色管理</a>
            <a href="#"  class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-user'" style="width: 150px;">模块管理</a>
            <a href="#" class="easyui-linkbutton"
               data-options="plain:true,iconCls:'icon-modifyPassword'" style="width: 150px;" id="change_p">修改密码</a>
            <a href="#" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-exit'"
               style="width: 150px;">安全退出</a>
        </div>

    </div>
</div>
{# 下边菜单 #}
<div region="south" style="height: 25px;padding: 5px;overflow: hidden;" align="center">
    版本所有 上海尚学堂 <a href="http://www.shsxt.com" target="_blank">www.shsxt.com</a>(2016-2026)
</div>

{# 修改密码对话框 #}
<div id="change_form_password" class="easyui-dialog" title="修改密码" >
    <form method="post",id="system_index_update_password_form">
        <table>
            <tr>
                <td>用户名:</td>
                <td><input class="easyui-validatebox"  name="reusername" type="text" id="form_username" value="{{ request.session.user_name }}"/></td>
            </tr>
            <tr>
                <td>旧密码:</td>
                <td><input class="easyui-validatebox" name="password" type="password" id="form_old_password" data-options="validType:['check_length']"/></td>
            </tr>
            <tr>
                <td>新密码:</td>
                <td><input class="easyui-validatebox" name="newpassword" type="password" id="form_new_password" data-options="validType:['check_length','regx_password']"/></td>
            </tr>
            <tr>
                <td>确认密码:</td>
                <td><input class="easyui-validatebox" name="againpassword" type="password" id="form_again_ new_password" data-options="validType:['check_length','regx_password','again_password[\'#form_new_password \']']"/></td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript">
    //安全退出和修改密码:   前台删cookie 后台删session
function act_u(username){
    //$('#form_username').val(username)
    $('#change_form_password').dialog('open')

}
$('#change_form_password').dialog({
    title: '修改密码',
    width: 260,
    height: 175,
    closed: true,
    cache: false,
    iconCls:'icon-save',
    modal: true,
    resizable:false,
    draggable:false,
    buttons:[{
				text:'确定',
                iconCls:'icon-ok',
				handler:function(){
                    var flag = $('#system_index_update_password_form').form('validate');
                    
                    if(flag){
                        //$('#system_index_update_password_form').submit()
                        submit_form()
                    }
                }
			},{
				text:'关闭',
                iconCls:'icon-no',
				handler:function(){
                    $('#system_index_update_password_dialog').dialog('close');
                }
			}]
});

$.extend($.fn.validatebox.defaults.rules, {
    check_length:{
        validator: function (value){
            return (value.length >=8 && value.length <= 16)
            },
        message: '密码长度必须为8~16位'
        },
    regx_password:{
        validator: function (value) {
            var reg = /^(?=.*?[a-z])(?=.*?[A-Z])(?=.*?\d)(?=.*?[#@*&.])[a-zA-Z\d#@*&.]{8,16}$/;
            return (reg.test(value))
        },
        message: '密码长度必须有大小写字母和特殊字符'
    },
    again_password:{
        validator: function (value,param) {
            //param取到dom对象,还需取jq对象再取值
            return (value == $(param[0]).val())
    },
    message: '两次密码不一致'
}}

);
//提交表单
function submit_form(){
$('#system_index_update_password_form').form('submit', {
        url:'system:update_password',
        success:function(result){
            alert(1)
        }
    });
}

</script>
</body>

</html>